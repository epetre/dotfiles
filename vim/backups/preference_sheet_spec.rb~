require 'spec_helper'

describe PreferenceSheet do
  before :each do
    @pref = PreferenceSheet.new(integration_id: "", integration_host: "")
    @pref.team_integration_id_filter = ['aaaa']
    @pref.stub(:available_team_integration_ids).and_return([['project1', '1'], ['project2', '2']])
  end

  it 'validates a bad pref throws' do
    @pref.integration_id = "some invalid token"
    @pref.stub(:token_valid?){false}
    @pref.valid?.should eq false 
    @pref.errors.count.should eq 1
  end

  it 'validates a good pref' do
    @pref.stub(:token_valid?){true}
    @pref.team_integration_id_filter = ['1', '2']
    @pref.errors[:base].count.should eq 0
    @pref.valid?.should eq true
  end
end
