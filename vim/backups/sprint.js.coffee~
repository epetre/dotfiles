#datepickers
#$("input[name*=days_callendar]").hide()
calendar = $('#days_callendar')
load_sprint_start_datepicker = (dates, includeWeekends) ->
  calendar.DatePicker
    mode: "multiple"
    inline: true
    calendars: 3
    markFuture: false
    includeWeekends: includeWeekends
    date: dates 
    current: dates[0] 
    onChange: (el) ->
      update_from_calendar()

$dates_handle = $("input[name*=days]")
dates = $dates_handle.val()
if dates
  dates = dates.split(' ')
  dates = (new Date(Date.parse(date)) for date in dates)
else
  dates = new Array(new Date())

load_sprint_start_datepicker dates,true

#private
$is_private = $('#sprint_is_private')
$('.private i').click ->
  $(this).toggleClass('icon-lock').toggleClass('icon-unlock')
  if $(this).hasClass('icon-lock')
    $is_private.val(true)
  else
    $is_private.val(false)


$('#include_weekends').click ->
  dates = calendar.DatePickerGetDate()[0]
  calendar.html('');
  include_weekends = $(this).is(':checked')
  unless include_weekends
    dates = new Array(dates) if dates.length is 1
    dates = trimWeekends dates

  load_sprint_start_datepicker(dates,include_weekends);
  update_from_calendar()

$total_points_handle = $('input[name*=total_points]')
$total_points_slider_handle = $('#total_points_slider')

$total_points_handle.change ->
  $total_points_slider_handle.slider("value", $(this).val())

$total_points_slider_handle.slider
  range: "min"
  value: $total_points_handle.val() 
  step: 1
  min: 0
  max: 200
  labels: 10
  tickLabels: [1,200]
  slide: (event, ui) ->
    $total_points_handle.val(ui.value)

update_from_calendar = () ->
  dates = sort_by_time_stamp calendar.DatePickerGetDate()[0]
  str = ''
  for i in [0...dates.length]
    unless i is 0
      str = str + ' '
    str = str + dates[i].toString('yyyy-MM-dd')

  $dates_handle.val str

sort_by_time_stamp = (dates) ->
  (new Date(date.valueOf()) for date in dates).sort()

trimWeekends = (dates) ->
  trimed_dates = new Array()

  for i in [0...dates.length]
    current = new Date(dates[i])
    unless (current.getDay() is 6 || current.getDay() is 0)
      trimed_dates.push(new Date(current))
  trimed_dates
